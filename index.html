<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PokeHype | Servidor de Pixelmon 1.12.2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="./src/images/logo.png" type="image/png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Press+Start+2P&family=Silkscreen:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --mc-green: #3CB371;
            --mc-dark-green: #2E8B57;
            --mc-brown: #8B4513;
            --mc-dark-brown: #654321;
            --mc-gray: #696969;
            --mc-dark-gray: #2F4F4F;
            --mc-light: #F5F5F5;
            --mc-yellow: #FFD700;
            --mc-red: #DC143C;
        }

        body {
            background-image: url("./src/images/background.gif");
            background-repeat: no-repeat;
            background-size: cover;
            background-attachment: fixed;
            font-family: 'Roboto', sans-serif;
            color: var(--mc-light);
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            z-index: -1;
        }

        .mc-font {
            font-family: 'Press Start 2P', 'Courier New', monospace;
            font-size: 0.8em;
            line-height: 1.4;
        }

        .mc-font-alt {
            font-family: 'Silkscreen', 'Courier New', monospace;
        }

        .mc-font-small {
            font-family: 'Silkscreen', 'Courier New', monospace;
            font-size: 0.9em;
        }

        .mc-button {
            background: linear-gradient(to bottom, var(--mc-green) 0%, var(--mc-dark-green) 100%);
            border: 2px solid #1a4d1a;
            border-radius: 4px;
            box-shadow: 0 4px 0 #1a4d1a;
            transition: all 0.1s ease;
            color: white;
            text-shadow: 1px 1px 0 #000;
            cursor: pointer;
        }

        .mc-button:hover {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #1a4d1a;
            background: linear-gradient(to bottom, var(--mc-dark-green) 0%, #267326 100%);
        }

        .mc-button:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        .mc-card {
            background: rgba(45, 45, 45, 0.9);
            border: 2px solid #5a5a5a;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            cursor: pointer;
        }

        .mc-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.6);
            border-color: var(--mc-green);
        }

        .mc-nav {
            background: rgba(30, 30, 30, 0.95);
            border-bottom: 3px solid var(--mc-green);
            backdrop-filter: blur(10px);
        }

        .mc-container {
            background: rgba(20, 20, 20, 0.85);
            border: 2px solid #444;
            border-radius: 8px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .mc-input {
            background: rgba(40, 40, 40, 0.9);
            border: 2px solid #5a5a5a;
            border-radius: 4px;
            color: white;
            padding: 8px 12px;
        }

        .mc-input:focus {
            border-color: var(--mc-green);
            outline: none;
        }

        .mc-tab {
            background: rgba(50, 50, 50, 0.9);
            border: 2px solid #5a5a5a;
            border-radius: 6px;
            transition: all 0.2s ease;
            white-space: nowrap;
            min-width: fit-content;
            cursor: pointer;
        }

        .mc-tab.active {
            background: rgba(60, 179, 113, 0.9);
            border-color: var(--mc-green);
            color: white;
            font-weight: bold;
        }

        .mc-tab:hover:not(.active) {
            background: rgba(70, 70, 70, 0.9);
        }

        .mc-divider {
            height: 2px;
            background: linear-gradient(to right, transparent, var(--mc-green), transparent);
            margin: 20px 0;
        }

        .mc-badge {
            background: var(--mc-red);
            color: white;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .category-scroll {
            display: flex;
            overflow-x: auto;
            gap: 8px;
            padding: 8px 0;
            scrollbar-width: thin;
            scrollbar-color: var(--mc-green) rgba(50, 50, 50, 0.8);
        }

        .category-scroll::-webkit-scrollbar {
            height: 6px;
        }

        .category-scroll::-webkit-scrollbar-track {
            background: rgba(50, 50, 50, 0.8);
            border-radius: 3px;
        }

        .category-scroll::-webkit-scrollbar-thumb {
            background: var(--mc-green);
            border-radius: 3px;
        }

        .page-hidden {
            display: none !important;
        }

        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .animate-pulse-mc {
            animation: pulse-mc 2s infinite;
        }

        @keyframes pulse-mc {
            0% { box-shadow: 0 0 0 0 rgba(60, 179, 113, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(60, 179, 113, 0); }
            100% { box-shadow: 0 0 0 0 rgba(60, 179, 113, 0); }
        }

        .grid-pattern {
            background-image: 
                linear-gradient(rgba(60, 179, 113, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(60, 179, 113, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* Corrigir problema de clique em imagens dentro de botões */
        .clickable img {
            pointer-events: none;
        }

        .clickable {
            cursor: pointer;
            user-select: none;
        }
    </style>
</head>
<body class="grid-pattern">
    <!-- Header -->
    <header class="mc-nav fixed w-full top-0 z-50 shadow-lg">
        <div class="container mx-auto px-4 py-2">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center mb-4 md:mb-0">
                    <img src="./src/images/logo.png" alt="PokeHype Logo" class="w-12 h-12 mr-3 animate-float">
                    <h1 class="mc-font text-2xl md:text-3xl text-white">
                        Poke<span class="text-green-400">Hype</span>
                    </h1>
                </div>
                
                <nav class="flex space-x-2 md:space-x-4">
                    <button id="shop_button" class="mc-button flex items-center px-4 py-2 clickable">
                        <img src="./src/images/shop.png" alt="Loja" class="w-5 h-5 mr-2 invert">
                        <span class="mc-font-small">Loja</span>
                    </button>
                    <button id="wiki_button" class="mc-button flex items-center px-4 py-2 clickable">
                        <img src="./src/images/wiki.png" alt="Wiki" class="w-5 h-5 mr-2 invert">
                        <span class="mc-font-small">Wiki</span>
                    </button>
                </nav>
            </div>
        </div>
    </header>

    <main class="pt-24 pb-16 min-h-screen">
        <!-- Página Principal -->
        <div id="contentMainPage" class="w-full">
            <!-- Hero Section -->
            <section class="container mx-auto px-4 mb-12">
                <div class="flex flex-col lg:flex-row items-center justify-between">
                    <div class="lg:w-1/2 mb-8 lg:mb-0 text-center lg:text-left">
                        <h2 class="mc-font text-4xl md:text-5xl lg:text-6xl text-white mb-4">
                            Poke<span class="text-green-400">Hype</span>
                        </h2>
                        <p class="text-xl md:text-2xl mb-6 mc-font-alt text-green-300">
                            O melhor servidor de Pixelmon do Brasil!
                        </p>
                        <p class="mb-8 text-gray-300 max-w-lg mx-auto lg:mx-0 mc-font-small">
                            Entre em um mundo repleto de aventuras Pokémon, batalhas épicas e uma comunidade incrível. 
                            Junte-se a nós e viva a experiência definitiva de Pixelmon no Minecraft!
                        </p>
                        
                        <div class="mc-card p-6 max-w-md mx-auto lg:mx-0">
                            <div class="flex items-center justify-between mb-4">
                                <span class="mc-font text-green-400">IP DO SERVIDOR</span>
                                <span class="mc-badge animate-pulse-mc">ONLINE</span>
                            </div>
                            <button id="ipButton" class="mc-button w-full flex justify-between items-center p-3 clickable">
                                <span class="mc-font-small" id="ip">jogar.pokehype.com.br</span>
                                <span class="mc-font-small bg-green-600 px-3 py-1 rounded">COPIAR</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="lg:w-1/2 flex justify-center">
                        <div class="relative">
                            <img src="./src/images/logo.png" alt="Logo PokeHype" class="w-64 md:w-80 h-auto rounded-full border-4 border-green-500 shadow-lg animate-float">
                            <div class="absolute -bottom-4 -right-4 bg-green-600 text-white mc-font-small px-3 py-1 rounded-full">
                                Pixelmon 8.4.3
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Loja Section -->
            <section class="container mx-auto px-4">
                <div class="mc-container p-6">
                    <div class="flex flex-col mb-6">
                        <h3 class="mc-font text-2xl md:text-3xl text-white mb-4 text-center">
                            Loja de Itens
                        </h3>
                        
                        <!-- Categorias com scroll horizontal -->
                        <div class="category-scroll" id="contentCategorysShop">
                            <div class="loader rounded-full animate-spin bg-transparent border-b-4 border-b-green-500 w-8 h-8"></div>
                        </div>
                    </div>
                    
                    <div class="mc-divider"></div>
                    
                    <div id="contentItemsShop" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        <div class="loader rounded-full animate-spin bg-transparent border-b-4 border-b-green-500 w-8 h-8 mx-auto col-span-full"></div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Página Wiki -->
        <div id="contentWikiPage" class="w-full page-hidden">
            <div class="container mx-auto px-4">
                <div class="mc-container p-6">
                    <div class="flex flex-col lg:flex-row">
                        <!-- Sidebar Wiki -->
                        <div class="lg:w-1/4 mb-6 lg:mb-0 lg:mr-6">
                            <div class="mc-card p-4">
                                <h3 class="mc-font text-xl text-green-400 mb-4 text-center">Menu Wiki</h3>
                                <div id="contentButtonsWiki" class="space-y-2 max-h-96 overflow-y-auto">
                                    <!-- Botões da Wiki serão inseridos aqui -->
                                    <div class="loader rounded-full animate-spin bg-transparent border-b-4 border-b-green-500 w-8 h-8 mx-auto"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Conteúdo Wiki -->
                        <div class="lg:w-3/4">
                            <div class="mc-card p-6">
                                <div id="titleContentWiki" class="mc-font text-2xl md:text-3xl text-green-400 mb-6 text-center border-b-2 border-green-800 pb-3">
                                    <!-- Título da página Wiki -->
                                </div>
                                <div id="contentGeneralWiki" class="prose prose-invert max-w-none">
                                    <!-- Conteúdo da página Wiki -->
                                    <p class="text-center text-gray-400 mc-font-small">Selecione uma categoria no menu para visualizar o conteúdo.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Página Termos -->
        <div id="contentTermsPage" class="w-full page-hidden">
            <div class="container mx-auto px-4">
                <div class="mc-container p-6 max-w-4xl mx-auto">
                    <h1 class="mc-font text-3xl md:text-4xl text-green-400 mb-6 text-center">Termos de Uso – PokeHype</h1>
                    <p class="text-center mb-8 text-gray-400 mc-font-small"><em>Última atualização: 21 de abril de 2025</em></p>
                    
                    <div class="mc-card p-6">
                        <!-- Conteúdo dos termos (mantido igual) -->
                        <section class="mb-8">
                            <h2 class="mc-font text-xl text-green-400 mb-3">1. Natureza das Transações</h2>
                            <p class="mb-4 text-gray-300 mc-font-small">1.1. Todas as compras realizadas na loja do PokeHype são classificadas como
                                <strong class="text-green-300">doações voluntárias</strong> para o projeto, com o objetivo de apoiar financeiramente a
                                manutenção, desenvolvimento e melhoria contínua do servidor.
                            </p>
                            <p class="mb-4 text-gray-300 mc-font-small">1.2. Os benefícios concedidos aos jogadores em troca dessas doações (itens, permissões,
                                ranks, moedas virtuais etc.) são meramente <strong class="text-green-300">gratificações simbólicas</strong> e <strong class="text-green-300">não possuem
                                    valor comercial ou monetário</strong> fora do ambiente virtual do servidor.</p>
                        </section>

                        <!-- Restante do conteúdo dos termos -->
                        <section class="mb-8">
                            <h2 class="mc-font text-xl text-green-400 mb-3">2. Política de Reembolso</h2>
                            <p class="mb-4 text-gray-300 mc-font-small">2.1. <strong class="text-green-300">Nenhuma compra é passível de reembolso</strong>, total ou parcial, em nenhuma
                                circunstância, incluindo, mas não se limitando a:</p>
                            <ul class="list-disc ml-6 mb-4 text-gray-300 mc-font-small">
                                <li>Inserção incorreta do nickname (nome de usuário);</li>
                                <li>Arrependimento após a compra;</li>
                                <li>Compra duplicada ou não intencional;</li>
                                <li>Incompatibilidade com versões do cliente ou problemas locais do jogador;</li>
                                <li>Suspensão, banimento ou perda de acesso ao servidor por violação das regras.</li>
                            </ul>
                            <p class="mb-4 text-gray-300 mc-font-small">2.2. Ao confirmar uma doação, o usuário reconhece que está ciente e de acordo com essa
                                política irreversível.</p>
                        </section>

                        <section class="mb-8">
                            <h2 class="mc-font text-xl text-green-400 mb-3">3. Responsabilidade do Usuário</h2>
                            <p class="mb-4 text-gray-300 mc-font-small">3.1. É de inteira <strong class="text-green-300">responsabilidade do usuário</strong> fornecer corretamente os dados
                                solicitados no momento da compra, especialmente o nickname (nome de usuário Minecraft).</p>
                            <p class="mb-4 text-gray-300 mc-font-small">3.2. O PokeHype <strong class="text-green-300">não se responsabiliza por erros de digitação</strong>, informações
                                inseridas de forma incorreta, ou por quaisquer consequências oriundas dessas falhas.</p>
                            <p class="mb-4 text-gray-300 mc-font-small">3.3. Recomendamos revisar atentamente todos os dados antes de concluir a transação.</p>
                        </section>

                        <section class="mb-8">
                            <h2 class="mc-font text-xl text-green-400 mb-3">4. Alterações nos Benefícios</h2>
                            <p class="mb-4 text-gray-300 mc-font-small">4.1. O servidor reserva-se o direito de <strong class="text-green-300">alterar, remover ou modificar os benefícios</strong>
                                oferecidos como resultado das doações a qualquer momento, sem aviso prévio, visando o
                                equilíbrio da jogabilidade ou por motivos técnicos/estratégicos.</p>
                        </section>

                        <section class="mb-8">
                            <h2 class="mc-font text-xl text-green-400 mb-3">5. Conduta e Sanções</h2>
                            <p class="mb-4 text-gray-300 mc-font-small">5.1. A doação <strong class="text-green-300">não isenta</strong> o jogador do cumprimento das regras do servidor. O
                                descumprimento das normas poderá resultar em punições como <strong class="text-green-300">banimento temporário ou permanente</strong>, sem qualquer tipo de compensação ou restituição dos valores doados.
                            </p>
                        </section>

                        <section class="mb-8">
                            <h2 class="mc-font text-xl text-green-400 mb-3">6. Disposições Gerais</h2>
                            <p class="mb-4 text-gray-300 mc-font-small">6.1. Estes Termos de Uso poderão ser atualizados periodicamente. É responsabilidade do
                                usuário manter-se informado sobre possíveis alterações.</p>
                            <p class="mb-4 text-gray-300 mc-font-small">6.2. Ao concluir uma compra, o usuário <strong class="text-green-300">declara estar de acordo com todos os pontos aqui descritos</strong>, assumindo total responsabilidade pela transação realizada.</p>
                        </section>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 border-t-4 border-green-600 py-8">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                <div class="text-center md:text-left">
                    <h3 class="mc-font text-green-400 mb-4">Acessibilidade</h3>
                    <button id="terms_button" class="mc-button flex items-center justify-center md:justify-start mx-auto md:mx-0 px-4 py-2 clickable">
                        <img src="./src/images/terms-and-conditions.png" alt="Termos" class="w-5 h-5 mr-2 invert">
                        <span class="mc-font-small">Termos e Condições</span>
                    </button>
                </div>
                
                <div class="text-center">
                    <h3 class="mc-font text-green-400 mb-4">Sobre Nós</h3>
                    <p class="text-gray-300 mc-font-small">
                        Criamos nosso servidor de Pixelmon em 2024 com um grande investimento em infraestrutura e desenvolvimento, 
                        com o objetivo de inovar a comunidade e oferecer uma experiência de jogo única.
                    </p>
                </div>
                
                <div class="text-center md:text-right">
                    <h3 class="mc-font text-green-400 mb-4">Redes Sociais</h3>
                    <a href="https://discord.gg/RMd3mTtj6M" target="_blank" class="mc-button inline-flex items-center px-4 py-2 clickable">
                        <img src="./src/images/discord.png" alt="Discord" class="w-5 h-5 mr-2 invert">
                        <span class="mc-font-small">Discord</span>
                    </a>
                </div>
            </div>
            
            <div class="mc-divider"></div>
            
            <div class="text-center text-gray-400 mc-font-small">
                <p class="mb-2">Copyright © PokeHype. Sem qualquer vínculo com Mojang Studios, Microsoft ou The Pokémon Company.</p>
                <p>Desenvolvido por <a href="https://luandev.blog.br" target="_blank" class="text-green-400 hover:underline">LuanDev</a>.</p>
            </div>
        </div>
    </footer>

    <script>
        const URL = "http://localhost:3000";

        // Variáveis globais
        let clickedIp = false;
        let pageSelected;
        let json;
        let categorySelected;
        let htmlBody;
        let itemSelected;
        let confirm = false;
        let jsonWiki;
        let quantity = 1;

        // Inicialização quando o DOM estiver carregado
        document.addEventListener("DOMContentLoaded", () => {
            updateCategorys();
            setupEventListeners();
            loadWikiData();
        });

        // Configuração de eventos
        function setupEventListeners() {
            document.addEventListener("click", (e) => {
                const element = e.target;
                
                // Botão de copiar IP
                if (element.closest('#ipButton')) {
                    e.preventDefault();
                    copyIpToClipboard();
                    return;
                }
                
                // Botão de aumentar quantidade
                if (element.id === "plus") {
                    e.preventDefault();
                    updateQuantity(1);
                    return;
                }

                // Botão de diminuir quantidade
                if (element.id === "minus") {
                    e.preventDefault();
                    updateQuantity(-1);
                    return;
                }

                // Seleção de categoria - CORREÇÃO: agora funciona clicando em qualquer parte do botão
                if (element.closest('.button_category')) {
                    e.preventDefault();
                    const categoryButton = element.closest('.button_category');
                    const categoryIndex = categoryButton.dataset.index;
                    selectCategory(categoryIndex);
                    return;
                }
                
                // Botão de voltar no modal
                if (element.id === "buttonBack" || element.closest('#buttonBack')) {
                    e.preventDefault();
                    closeModalShopItem();
                    return;
                }
                
                // Botão de confirmar compra
                if (element.id === "confirmBuyButton" || element.closest('#confirmBuyButton')) {
                    e.preventDefault();
                    confirmBuy();
                    return;
                }
                
                // Links de termos
                if (element.id === "terms_button" || element.closest('#terms_button')) {
                    e.preventDefault();
                    showTermsPage();
                    return;
                }
                
                // Links de wiki
                if (element.id === "wiki_button" || element.closest('#wiki_button')) {
                    e.preventDefault();
                    showWikiPage();
                    return;
                }
                
                // Links de loja
                if (element.id === "shop_button" || element.closest('#shop_button')) {
                    e.preventDefault();
                    showShopPage();
                    return;
                }

                // Clicar em itens da loja - CORREÇÃO: agora funciona clicando em qualquer parte do card
                if (element.closest('.mc-card') && element.closest('.mc-card').hasAttribute('data-item')) {
                    e.preventDefault();
                    const card = element.closest('.mc-card');
                    const item = JSON.parse(card.dataset.item);
                    if (item) {
                        onClickItemShop(item);
                    }
                    return;
                }

                // Clicar em botões da wiki - CORREÇÃO: agora funciona clicando em qualquer parte do botão
                if (element.closest('.buttonWiki')) {
                    e.preventDefault();
                    const wikiButton = element.closest('.buttonWiki');
                    onClickButtonWiki(wikiButton);
                    return;
                }
            });

            // Escrevendo no campo do nick
            document.addEventListener("input", (e) => {
                const element = e.target;
                if (element.id !== "inputNick") return;
                
                const img = document.getElementById("playerOfNick");
                const sanitizedValue = sanitizeInput(element.value);
                
                if (sanitizedValue.length >= 3) {
                    img.src = `https://mc-heads.net/player/${sanitizedValue}`;
                } else {
                    img.src = `https://mc-heads.net/player/`;
                }
            });
        }

        // Selecionar categoria
        function selectCategory(categoryIndex) {
            // Remove a classe active de todas as categorias
            document.querySelectorAll('.button_category').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Adiciona a classe active na categoria selecionada
            const selectedBtn = document.querySelector(`[data-index="${categoryIndex}"]`);
            if (selectedBtn) {
                selectedBtn.classList.add('active');
            }
            
            // Carrega os itens da categoria
            categorySelected = categoryIndex;
            onClickCategory(json["categorys"][categoryIndex]);
        }

        // Atualizar categorias
        async function updateCategorys() {
            const contentCategorys = document.getElementById("contentCategorysShop");
            
            try {
                const req = await fetch(`${URL}/config`);
                if (!req.ok) throw new Error("Falha na requisição");
                
                json = await req.json();
                if (!json) throw new Error("JSON inválido");
                
                contentCategorys.innerHTML = "";
                
                json["categorys"].forEach((element, i) => {
                    const nameCategory = element["name"];
                    const iconPath = element["pathIcon"];
                    
                    const htmlCategory = `
                        <button class="button_category mc-tab flex items-center px-4 py-2 clickable ${i === 0 ? 'active' : ''}" data-index="${i}">
                            <img src="${URL}/image/${iconPath}" alt="${nameCategory}" class="w-5 h-5 mr-2">
                            <span class="mc-font-small">${nameCategory}</span>
                        </button>
                    `;
                    contentCategorys.innerHTML += htmlCategory;
                });

                if (contentCategorys.childElementCount > 0) {
                    // Seleciona a primeira categoria por padrão
                    selectCategory(0);
                } else {
                    contentCategorys.innerHTML = `<div class="loader rounded-full animate-spin bg-transparent border-b-4 border-b-green-500 w-8 h-8"></div>`;
                }
            } catch (error) {
                console.log("Não foi possível conectar às categorias da loja, tentando novamente...");
                setTimeout(updateCategorys, 5000);
            }
        }

        // Ao clicar em uma categoria
        function onClickCategory(category) {
            const contentItems = document.getElementById("contentItemsShop");
            
            contentItems.innerHTML = "";
            
            // Verifica se category é válido e tem items
            if (!category || !category.items) {
                console.error("Categoria inválida:", category);
                contentItems.innerHTML = `<p class="text-gray-300 text-center col-span-full py-8 mc-font-small">Erro ao carregar itens</p>`;
                return;
            }
            
            category.items.forEach((item, index) => {
                const title = item["title"];
                const subtitle = item["subtitle"];
                const description = item["description"];
                const iconPathItem = item["iconPath"];
                const price = item["price"];
                const promotion = item["promotion"];
                
                const htmlItem = `
                    <div class="mc-card p-4 flex flex-col h-full clickable" data-item='${JSON.stringify(item).replace(/'/g, "&#39;")}'>
                        <div class="flex justify-center mb-4">
                            <img src="${URL}/image/${iconPathItem}" alt="${title}" class="w-24 h-24 object-contain">
                        </div>
                        <h4 class="mc-font text-lg text-white mb-2 text-center">${title}</h4>
                        <p class="text-green-300 text-center mb-3 mc-font-small">${subtitle}</p>
                        
                        <div class="flex justify-center items-center mb-4">
                            ${promotion ? `<span class="mc-font text-red-400 line-through mr-2">R$ ${(price*2).toFixed(2)}</span>` : ''}
                            <span class="mc-font text-yellow-400 text-xl">R$ ${price}</span>
                        </div>
                        
                        <p class="text-gray-400 text-sm mb-4 flex-grow text-center mc-font-small">${description}</p>
                        
                        <button class="mc-button w-full flex items-center justify-center py-2 mt-auto clickable">
                            <img src="./src/images/shopping_cart.png" alt="Comprar" class="w-5 h-5 mr-2 invert">
                            <span class="mc-font-small">Comprar Agora</span>
                        </button>
                    </div>
                `;
                contentItems.innerHTML += htmlItem;
            });
        }

        // Ao clicar em um item da loja - CORREÇÃO: função modificada para receber o item diretamente
        function onClickItemShop(item) {
            if (!item) return;
            
            // Salva o conteúdo atual da página
            htmlBody = document.body.innerHTML;
            
            // Cria o modal de compra
            createPurchaseModal(item);
        }

        // Criar modal de compra
        function createPurchaseModal(item) {
            const title = item["title"];
            const subtitle = item["subtitle"];
            const description = item["description"];
            const iconPathItem = item["iconPath"];
            const price = item["price"];
            
            const modalHtml = `
                <div class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-80">
                    <div class="mc-container w-full max-w-4xl max-h-[90vh] overflow-y-auto">
                        <div class="flex justify-between items-center p-4 border-b border-gray-700">
                            <h2 class="mc-font text-2xl text-green-400">Comprar ${title}</h2>
                            <button class="text-gray-400 hover:text-white text-2xl clickable" id="buttonBack">&times;</button>
                        </div>
                        <div class="p-6">
                            <div class="flex flex-col lg:flex-row gap-6 mb-6">
                                <!-- Informações do produto -->
                                <div class="lg:w-2/5">
                                    <div class="mc-card p-4 flex flex-col items-center text-center">
                                        <img src="${URL}/image/${iconPathItem}" alt="${title}" class="w-32 h-32 mb-4">
                                        <h3 class="mc-font text-xl text-white mb-2">${title}</h3>
                                        <p class="text-green-300 mb-4 mc-font-small">${subtitle}</p>
                                        <div class="mc-font text-2xl text-yellow-400 mb-4" id="priceDiv">R$ ${price}</div>
                                        <p class="text-gray-300 text-sm mc-font-small">${description}</p>
                                    </div>
                                </div>
                                
                                <!-- Formulário de compra -->
                                <div class="lg:w-3/5">
                                    <div class="mc-card p-4">
                                        <h3 class="mc-font text-xl text-green-400 mb-4">Informações da Compra</h3>
                                        
                                        <div class="mb-4">
                                            <label for="inputNick" class="block text-gray-300 mb-2 mc-font-small">Nickname no Minecraft <span class="text-red-500">*</span></label>
                                            <input type="text" id="inputNick" class="mc-input w-full" placeholder="Ex: lHawk_" maxlength="16">
                                        </div>
                                        
                                        <div class="mb-6">
                                            <label class="block text-gray-300 mb-2 mc-font-small">Quantidade</label>
                                            <div class="flex items-center justify-between max-w-xs">
                                                <button id="minus" class="mc-button w-10 h-10 flex items-center justify-center text-lg clickable">-</button>
                                                <div id="inputQuantity" class="mc-font text-xl mx-4 w-12 text-center">1</div>
                                                <button id="plus" class="mc-button w-10 h-10 flex items-center justify-center text-lg clickable">+</button>
                                            </div>
                                        </div>
                                        
                                        <button id="confirmBuyButton" class="mc-button w-full flex items-center justify-center py-3 text-lg clickable">
                                            <img src="./src/images/check.png" alt="Confirmar" class="w-6 h-6 mr-2 invert">
                                            <span class="mc-font">Confirmar Compra</span>
                                        </button>
                                    </div>
                                    
                                    <!-- Preview do jogador -->
                                    <div class="mc-card p-4 mt-4 flex flex-col items-center">
                                        <img src="https://mc-heads.net/player/" alt="Player Skin" class="w-32 h-auto mb-2" id="playerOfNick">
                                        <p class="text-gray-300 mc-font-small text-center">Preview do seu personagem</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Aviso importante -->
                            <div class="mc-card p-4 bg-red-900 bg-opacity-30 border-red-700">
                                <div class="flex items-start">
                                    <img src="./src/images/warning.png" alt="Aviso" class="w-6 h-6 mr-3 mt-1 invert">
                                    <div>
                                        <span class="font-bold text-red-300 mc-font-small">ATENÇÃO:</span>
                                        <p class="text-gray-300 mc-font-small mt-1">
                                            Ao comprar o produto, você concorda automaticamente com nossos 
                                            <a href="#" class="text-green-300 hover:underline clickable" onclick="showTermsPage()">termos e condições</a>. 
                                            Após o pagamento, você deverá entrar em nosso servidor com o nick selecionado e executar o comando 
                                            <span class="text-green-400 mc-font-small">/CaixaPostal</span> para verificar o status do pagamento e resgatar suas compras.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            quantity = 1;
            itemSelected = item;
            confirm = false;
            
            document.body.innerHTML = modalHtml;
            updatePriceItem();
            setupEventListeners();
        }

        // Atualizar quantidade - CORRIGIDO: agora adiciona de 1 em 1
        function updateQuantity(change) {
            const inputQuantity = document.getElementById("inputQuantity");
            if (!inputQuantity) return;
            
            let currentQuantity = parseInt(inputQuantity.textContent);
            
            // CORREÇÃO: Agora adiciona/subtrai apenas 1 unidade
            quantity = currentQuantity + change;
            quantity = Math.max(1, Math.min(10, quantity)); // Limita entre 1 e 10
            
            inputQuantity.textContent = quantity;
            updatePriceItem();
        }

        // Atualizar preço do item
        function updatePriceItem() {
            const element = document.getElementById("priceDiv");
            if (!element || !itemSelected) return;
            
            const totalPrice = (itemSelected["price"] * quantity).toFixed(2);
            element.textContent = `R$ ${totalPrice}`;
        }

        // Copiar IP para a área de transferência
        function copyIpToClipboard() {
            if (clickedIp) return;
            
            const ipElement = document.getElementById("ip");
            const originalText = ipElement.textContent;
            const ipToCopy = originalText.replace('IP:', '').trim();
            
            navigator.clipboard.writeText(ipToCopy).then(() => {
                const button = document.getElementById("ipButton");
                const originalHTML = button.innerHTML;
                
                button.innerHTML = `
                    <span class="mc-font-small text-green-300">IP COPIADO!</span>
                    <span class="mc-font-small bg-green-700 px-3 py-1 rounded">✓</span>
                `;
                
                setTimeout(() => {
                    button.innerHTML = originalHTML;
                    clickedIp = false;
                }, 1500);
            }).catch((err) => {
                const button = document.getElementById("ipButton");
                const originalHTML = button.innerHTML;
                
                button.innerHTML = `
                    <span class="mc-font-small text-red-300">ERRO AO COPIAR</span>
                    <span class="mc-font-small bg-red-700 px-3 py-1 rounded">✗</span>
                `;
                
                setTimeout(() => {
                    button.innerHTML = originalHTML;
                    clickedIp = false;
                }, 1500);
            });
        }

        // Sanitizar entrada de texto
        function sanitizeInput(input) {
            // Remove tags HTML
            input = input.replace(/<[^>]*>?/gm, '');
            
            // Permite letras, números, espaços, underscores e pontos
            input = input.replace(/[^a-zA-Z0-9\\s_\\.]/g, '');
            
            // Remove espaços em branco no início e no final
            input = input.trim();
            
            // Remove espaços em branco extras no meio
            input = input.replace(/\\s+/g, ' ');
            
            return input;
        }

        // Fechar modal de compra
        function closeModalShopItem() {
            document.body.innerHTML = htmlBody;
            // Reconfigura os event listeners após restaurar o conteúdo
            setupEventListeners();
        }

        // Confirmar compra
        async function confirmBuy() {
            if (confirm) return;
            confirm = true;
            
            const button = document.getElementById("confirmBuyButton");
            if (!button) return;
            
            const originalContent = button.innerHTML;
            button.innerHTML = `<div class="loader rounded-full animate-spin bg-transparent border-b-4 border-b-green-500 w-8 h-8"></div>`;
            button.disabled = true;
            
            const item = itemSelected;
            const title = item["title"];
            const subtitle = item["subtitle"];
            const description = item["description"];
            const iconPathItem = item["iconPath"];
            const price = item["price"];
            const itemIndex = item["itemIndex"];
            const categoryIndex = item["categoryIndex"];
            const nickElement = document.getElementById("inputNick");
            const nick = nickElement ? nickElement.value : '';
            
            if (!nick || nick.length < 3) {
                alert("O nick deve ter no mínimo 3 caracteres!");
                button.innerHTML = originalContent;
                button.disabled = false;
                confirm = false;
                return;
            }
            
            try {
                const req = await fetch(`${URL}/payment`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        nick: nick,
                        title: title,
                        description: title + ", " + subtitle + ". " + description,
                        pictureUrl: `${URL}/image/${iconPathItem}`,
                        unit_price: Number(price).toFixed(2),
                        quantity: quantity,
                        itemIndex: itemIndex,
                        categoryIndex: categoryIndex
                    })
                });

                const json = await req.json();
                if (!json || !json.initPoint) {
                    throw new Error("Resposta inválida do servidor");
                }
                
                // Abre em nova aba/janela
                window.open(json.initPoint, "_blank");
                
                // Fecha o modal e recarrega a página após um breve delay
                setTimeout(() => {
                    closeModalShopItem();
                    window.location.reload();
                }, 2000);
                
            } catch (error) {
                console.error("Erro na compra:", error);
                alert("Não foi possível completar a compra, tente novamente mais tarde!");
                button.innerHTML = originalContent;
                button.disabled = false;
                confirm = false;
            }
        }

        // Funções de navegação entre páginas
        function showTermsPage() {
            document.querySelectorAll('.page-hidden').forEach(page => {
                page.classList.remove('page-hidden');
            });
            document.getElementById('contentMainPage').classList.add('page-hidden');
            document.getElementById('contentWikiPage').classList.add('page-hidden');
            document.getElementById('contentTermsPage').classList.remove('page-hidden');
            
            // Scroll para o topo
            window.scrollTo(0, 0);
        }

        function showWikiPage() {
            document.querySelectorAll('.page-hidden').forEach(page => {
                page.classList.remove('page-hidden');
            });
            document.getElementById('contentMainPage').classList.add('page-hidden');
            document.getElementById('contentWikiPage').classList.remove('page-hidden');
            document.getElementById('contentTermsPage').classList.add('page-hidden');
            
            // Scroll para o topo
            window.scrollTo(0, 0);
        }

        function showShopPage() {
            document.querySelectorAll('.page-hidden').forEach(page => {
                page.classList.remove('page-hidden');
            });
            document.getElementById('contentMainPage').classList.remove('page-hidden');
            document.getElementById('contentWikiPage').classList.add('page-hidden');
            document.getElementById('contentTermsPage').classList.add('page-hidden');
            
            // Scroll para o topo
            window.scrollTo(0, 0);
        }

        // Carregar dados da wiki
        async function loadWikiData() {
            try {
                const req = await fetch(`${URL}/wiki`);
                const json = await req.json();
                if (!json) return;
                jsonWiki = json;
                
                const contentButtons = document.getElementById("contentButtonsWiki");
                contentButtons.innerHTML = "";
                let index = 0;
                for(let element of json["pages"]) {
                    let name = element["name"];
                    let iconPath = element["iconPath"];
                    let title = element["title"];
                    let contentHtml = element["content"];
                    
                    const htmlButton = `
                        <button class="buttonWiki mc-button w-full flex items-center justify-start p-3 mb-2 clickable ${index === 0 ? 'active' : ''}" data-item="${index}" id="buttonWiki_${index}">
                            <img src="${URL}/image/${iconPath}" alt="${name} icon" class="w-5 h-5 mr-3">
                            <span class="mc-font-small">${title}</span>
                        </button>
                    `;
                    contentButtons.innerHTML += htmlButton;
                    index++;
                }

                if (contentButtons.childElementCount > 0) {
                    const firstElement = contentButtons.querySelector(".buttonWiki");
                    if (firstElement) {
                        onClickButtonWiki(firstElement);
                    }
                } else {
                    contentButtons.innerHTML = `<div class="loader rounded-full animate-spin bg-transparent border-b-4 border-b-green-500 w-8 h-8 mx-auto"></div>`;
                }
            } catch (error) {
                console.log("Não foi possível conectar à wiki, tentando novamente...");
                setTimeout(loadWikiData, 5000);
            }
        }

        // Ao clicar em um botão da wiki - CORREÇÃO: função modificada para receber o elemento diretamente
        function onClickButtonWiki(buttonElement) {
            if (!buttonElement.classList.contains("buttonWiki")) return;
            
            document.querySelectorAll(".buttonWiki").forEach(button => {
                button.classList.remove("active");
            });
            
            buttonElement.classList.add("active");
            const element = jsonWiki["pages"][buttonElement.dataset.item];
            const title = element["title"];

            // setando o titulo da pagina.
            const contentTitle = document.getElementById("titleContentWiki");
            contentTitle.innerHTML = title;

            // setando o conteúdo da pagina.
            const content = document.getElementById("contentGeneralWiki");
            content.innerHTML = element["content"];
        }
    </script>
</body>
</html>