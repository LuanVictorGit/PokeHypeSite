<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PokeHype | Servidor de Pixelmon 1.12.2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="./src/images/logo.png" type="image/png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Press+Start+2P&family=Silkscreen:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --mc-green: #3CB371;
            --mc-dark-green: #2E8B57;
            --mc-brown: #8B4513;
            --mc-dark-brown: #654321;
            --mc-gray: #696969;
            --mc-dark-gray: #2F4F4F;
            --mc-light: #F5F5F5;
            --mc-yellow: #FFD700;
            --mc-red: #DC143C;
        }

        body {
            background-image: url("./src/images/background.gif");
            background-repeat: no-repeat;
            background-size: cover;
            background-attachment: fixed;
            font-family: 'Roboto', sans-serif;
            color: var(--mc-light);
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            z-index: -1;
        }

        .mc-font {
            font-family: 'Press Start 2P', 'Courier New', monospace;
            font-size: 0.8em;
            line-height: 1.4;
        }

        .mc-font-alt {
            font-family: 'Silkscreen', 'Courier New', monospace;
        }

        .mc-font-small {
            font-family: 'Silkscreen', 'Courier New', monospace;
            font-size: 0.9em;
        }

        .mc-button {
            background: linear-gradient(to bottom, var(--mc-green) 0%, var(--mc-dark-green) 100%);
            border: 2px solid #1a4d1a;
            border-radius: 4px;
            box-shadow: 0 4px 0 #1a4d1a;
            transition: all 0.1s ease;
            color: white;
            text-shadow: 1px 1px 0 #000;
            cursor: pointer;
        }

        .mc-button:hover {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #1a4d1a;
            background: linear-gradient(to bottom, var(--mc-dark-green) 0%, #267326 100%);
        }

        .mc-button:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        .mc-card {
            background: rgba(45, 45, 45, 0.9);
            border: 2px solid #5a5a5a;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            cursor: pointer;
        }

        .mc-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.6);
            border-color: var(--mc-green);
        }

        .mc-nav {
            background: rgba(30, 30, 30, 0.95);
            border-bottom: 3px solid var(--mc-green);
            backdrop-filter: blur(10px);
        }

        .mc-container {
            background: rgba(20, 20, 20, 0.85);
            border: 2px solid #444;
            border-radius: 8px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .mc-input {
            background: rgba(40, 40, 40, 0.9);
            border: 2px solid #5a5a5a;
            border-radius: 4px;
            color: white;
            padding: 8px 12px;
        }

        .mc-input:focus {
            border-color: var(--mc-green);
            outline: none;
        }

        .mc-tab {
            background: rgba(50, 50, 50, 0.9);
            border: 2px solid #5a5a5a;
            border-radius: 6px;
            transition: all 0.2s ease;
            white-space: nowrap;
            min-width: fit-content;
            cursor: pointer;
        }

        .mc-tab.active {
            background: rgba(60, 179, 113, 0.9);
            border-color: var(--mc-green);
            color: white;
            font-weight: bold;
        }

        .mc-tab:hover:not(.active) {
            background: rgba(70, 70, 70, 0.9);
        }

        .mc-divider {
            height: 2px;
            background: linear-gradient(to right, transparent, var(--mc-green), transparent);
            margin: 20px 0;
        }

        .mc-badge {
            background: var(--mc-red);
            color: white;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .category-scroll {
            display: flex;
            overflow-x: auto;
            gap: 8px;
            padding: 8px 0;
            scrollbar-width: thin;
            scrollbar-color: var(--mc-green) rgba(50, 50, 50, 0.8);
        }

        .category-scroll::-webkit-scrollbar {
            height: 6px;
        }

        .category-scroll::-webkit-scrollbar-track {
            background: rgba(50, 50, 50, 0.8);
            border-radius: 3px;
        }

        .category-scroll::-webkit-scrollbar-thumb {
            background: var(--mc-green);
            border-radius: 3px;
        }

        .page-hidden {
            display: none !important;
        }

        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .animate-pulse-mc {
            animation: pulse-mc 2s infinite;
        }

        @keyframes pulse-mc {
            0% { box-shadow: 0 0 0 0 rgba(60, 179, 113, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(60, 179, 113, 0); }
            100% { box-shadow: 0 0 0 0 rgba(60, 179, 113, 0); }
        }

        .grid-pattern {
            background-image: 
                linear-gradient(rgba(60, 179, 113, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(60, 179, 113, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* Corrigir problema de clique em imagens dentro de botões */
        .clickable img {
            pointer-events: none;
        }

        .clickable {
            cursor: pointer;
            user-select: none;
        }

        /* Estilos para subcategorias com dropdown - CORRIGIDO */
        .category-with-dropdown {
            position: relative;
            display: flex;
            flex-direction: column;
            height: fit-content;
        }

        .dropdown-arrow {
            transition: transform 0.3s ease;
            margin-left: 8px;
        }

        .category-with-dropdown.active .dropdown-arrow {
            transform: rotate(180deg);
        }

        .subcategory-dropdown {
            width: 100%;
            background: rgba(30, 30, 30, 0.98);
            border: 2px solid #5a5a5a;
            border-top: none;
            border-radius: 0 0 6px 6px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            flex-direction: column;
        }

        .category-with-dropdown.active .subcategory-dropdown {
            display: flex;
        }

        .subcategory-tab {
            background: rgba(40, 40, 40, 0.9);
            border: none;
            border-bottom: 1px solid #5a5a5a;
            padding: 10px 12px;
            text-align: left;
            transition: all 0.2s ease;
            color: var(--mc-light);
            cursor: pointer;
            font-family: 'Silkscreen', 'Courier New', monospace;
            font-size: 0.8rem;
            white-space: nowrap;
        }

        .subcategory-tab:last-child {
            border-bottom: none;
        }

        .subcategory-tab:hover {
            background: rgba(60, 60, 60, 0.9);
        }

        .subcategory-tab.active {
            background: rgba(80, 200, 120, 0.9);
            color: white;
            font-weight: bold;
        }

        /* Modal styles - CORRIGIDO */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: rgba(20, 20, 20, 0.95);
            border: 2px solid #444;
            border-radius: 8px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            z-index: 10000;
        }
    </style>
</head>
<body class="grid-pattern">
    <!-- Header -->
    <header class="mc-nav fixed w-full top-0 z-50 shadow-lg">
        <div class="container mx-auto px-4 py-2">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center mb-4 md:mb-0">
                    <img src="./src/images/logo.png" alt="PokeHype Logo" class="w-12 h-12 mr-3 animate-float">
                    <h1 class="mc-font text-2xl md:text-3xl text-white">
                        Poke<span class="text-green-400">Hype</span>
                    </h1>
                </div>
                
                <nav class="flex space-x-2 md:space-x-4">
                    <button id="shop_button" class="mc-button flex items-center px-4 py-2 clickable">
                        <img src="./src/images/shop.png" alt="Loja" class="w-5 h-5 mr-2 invert">
                        <span class="mc-font-small">Loja</span>
                    </button>
                    <button id="wiki_button" class="mc-button flex items-center px-4 py-2 clickable">
                        <img src="./src/images/wiki.png" alt="Wiki" class="w-5 h-5 mr-2 invert">
                        <span class="mc-font-small">Wiki</span>
                    </button>
                </nav>
            </div>
        </div>
    </header>

    <!-- Modal de Compra -->
    <div id="purchaseModal" class="modal-overlay">
        <div class="modal-content">
            <!-- Conteúdo do modal será inserido aqui via JavaScript -->
        </div>
    </div>

    <main class="pt-24 pb-16 min-h-screen">
        <!-- Página Principal -->
        <div id="contentMainPage" class="w-full">
            <!-- Hero Section -->
            <section class="container mx-auto px-4 mb-12">
                <div class="flex flex-col lg:flex-row items-center justify-between">
                    <div class="lg:w-1/2 mb-8 lg:mb-0 text-center lg:text-left">
                        <h2 class="mc-font text-4xl md:text-5xl lg:text-6xl text-white mb-4">
                            Poke<span class="text-green-400">Hype</span>
                        </h2>
                        <p class="text-xl md:text-2xl mb-6 mc-font-alt text-green-300">
                            O melhor servidor de Pixelmon do Brasil!
                        </p>
                        <p class="mb-8 text-gray-300 max-w-lg mx-auto lg:mx-0 mc-font-small">
                            Entre em um mundo repleto de aventuras Pokémon, batalhas épicas e uma comunidade incrível. 
                            Junte-se a nós e viva a experiência definitiva de Pixelmon no Minecraft!
                        </p>
                        
                        <div class="mc-card p-6 max-w-md mx-auto lg:mx-0">
                            <div class="flex items-center justify-between mb-4">
                                <span class="mc-font text-green-400">IP DO SERVIDOR</span>
                                <span class="mc-badge animate-pulse-mc">ONLINE</span>
                            </div>
                            <button id="ipButton" class="mc-button w-full flex justify-between items-center p-3 clickable">
                                <span class="mc-font-small" id="ip">jogar.pokehype.com.br</span>
                                <span class="mc-font-small bg-green-600 px-3 py-1 rounded">COPIAR</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="lg:w-1/2 flex justify-center">
                        <div class="relative">
                            <img src="./src/images/logo.png" alt="Logo PokeHype" class="w-64 md:w-80 h-auto rounded-full border-4 border-green-500 shadow-lg animate-float">
                            <div class="absolute -bottom-4 -right-4 bg-green-600 text-white mc-font-small px-3 py-1 rounded-full">
                                Pixelmon 8.4.3
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Loja Section -->
            <section class="container mx-auto px-4">
                <div class="mc-container p-6">
                    <div class="flex flex-col mb-6">
                        <h3 class="mc-font text-2xl md:text-3xl text-white mb-4 text-center">
                            Loja de Itens
                        </h3>
                        
                        <!-- Categorias com scroll horizontal -->
                        <div class="category-scroll" id="contentCategorysShop">
                            <div class="loader rounded-full animate-spin bg-transparent border-b-4 border-b-green-500 w-8 h-8"></div>
                        </div>
                    </div>
                    
                    <div class="mc-divider"></div>
                    
                    <div id="contentItemsShop" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        <div class="loader rounded-full animate-spin bg-transparent border-b-4 border-b-green-500 w-8 h-8 mx-auto col-span-full"></div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Página Wiki -->
        <div id="contentWikiPage" class="w-full page-hidden">
            <div class="container mx-auto px-4">
                <div class="mc-container p-6">
                    <div class="flex flex-col lg:flex-row">
                        <!-- Sidebar Wiki -->
                        <div class="lg:w-1/4 mb-6 lg:mb-0 lg:mr-6">
                            <div class="mc-card p-4">
                                <h3 class="mc-font text-xl text-green-400 mb-4 text-center">Menu Wiki</h3>
                                <div id="contentButtonsWiki" class="space-y-2 max-h-96 overflow-y-auto">
                                    <!-- Botões da Wiki serão inseridos aqui -->
                                    <div class="loader rounded-full animate-spin bg-transparent border-b-4 border-b-green-500 w-8 h-8 mx-auto"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Conteúdo Wiki -->
                        <div class="lg:w-3/4">
                            <div class="mc-card p-6">
                                <div id="titleContentWiki" class="mc-font text-2xl md:text-3xl text-green-400 mb-6 text-center border-b-2 border-green-800 pb-3">
                                    <!-- Título da página Wiki -->
                                </div>
                                <div id="contentGeneralWiki" class="prose prose-invert max-w-none">
                                    <!-- Conteúdo da página Wiki -->
                                    <p class="text-center text-gray-400 mc-font-small">Selecione uma categoria no menu para visualizar o conteúdo.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Página Termos -->
        <div id="contentTermsPage" class="w-full page-hidden">
            <div class="container mx-auto px-4">
                <div class="mc-container p-6 max-w-4xl mx-auto">
                    <h1 class="mc-font text-3xl md:text-4xl text-green-400 mb-6 text-center">Termos de Uso – PokeHype</h1>
                    <p class="text-center mb-8 text-gray-400 mc-font-small"><em>Última atualização: 21 de abril de 2025</em></p>
                    
                    <div class="mc-card p-6">
                        <!-- Conteúdo dos termos (mantido igual) -->
                        <section class="mb-8">
                            <h2 class="mc-font text-xl text-green-400 mb-3">1. Natureza das Transações</h2>
                            <p class="mb-4 text-gray-300 mc-font-small">1.1. Todas as compras realizadas na loja do PokeHype são classificadas como
                                <strong class="text-green-300">doações voluntárias</strong> para o projeto, com o objetivo de apoiar financeiramente a
                                manutenção, desenvolvimento e melhoria contínua do servidor.
                            </p>
                            <p class="mb-4 text-gray-300 mc-font-small">1.2. Os benefícios concedidos aos jogadores em troca dessas doações (itens, permissões,
                                ranks, moedas virtuais etc.) são meramente <strong class="text-green-300">gratificações simbólicas</strong> e <strong class="text-green-300">não possuem
                                    valor comercial ou monetário</strong> fuera do ambiente virtual do servidor.</p>
                        </section>

                        <!-- Restante do conteúdo dos termos -->
                        <section class="mb-8">
                            <h2 class="mc-font text-xl text-green-400 mb-3">2. Política de Reembolso</h2>
                            <p class="mb-4 text-gray-300 mc-font-small">2.1. <strong class="text-green-300">Nenhuma compra é passível de reembolso</strong>, total ou parcial, em nenhuma
                                circunstância, incluindo, mas não se limitando a:</p>
                            <ul class="list-disc ml-6 mb-4 text-gray-300 mc-font-small">
                                <li>Inserção incorreta do nickname (nome de usuário);</li>
                                <li>Arrependimento após a compra;</li>
                                <li>Compra duplicada ou não intencional;</li>
                                <li>Incompatibilidade com versões do cliente ou problemas locais do jogador;</li>
                                <li>Suspensão, banimento ou perda de acesso ao servidor por violação das regras.</li>
                            </ul>
                            <p class="mb-4 text-gray-300 mc-font-small">2.2. Ao confirmar uma doação, o usuário reconhece que está ciente e de acordo com essa
                                política irreversível.</p>
                        </section>

                        <section class="mb-8">
                            <h2 class="mc-font text-xl text-green-400 mb-3">3. Responsabilidade do Usuário</h2>
                            <p class="mb-4 text-gray-300 mc-font-small">3.1. É de inteira <strong class="text-green-300">responsabilidade do usuário</strong> fornecer corretamente os dados
                                solicitados no momento da compra, especialmente o nickname (nome de usuário Minecraft).</p>
                            <p class="mb-4 text-gray-300 mc-font-small">3.2. O PokeHype <strong class="text-green-300">não se responsabiliza por erros de digitação</strong>, informações
                                inseridas de forma incorreta, ou por quaisquer consequências oriundas dessas falhas.</p>
                            <p class="mb-4 text-gray-300 mc-font-small">3.3. Recomendamos revisar atentamente todos os dados antes de concluir a transação.</p>
                        </section>

                        <section class="mb-8">
                            <h2 class="mc-font text-xl text-green-400 mb-3">4. Alterações nos Benefícios</h2>
                            <p class="mb-4 text-gray-300 mc-font-small">4.1. O servidor reserva-se o direito de <strong class="text-green-300">alterar, remover ou modificar os benefícios</strong>
                                oferecidos como resultado das doações a qualquer momento, sem aviso prévio, visando o
                                equilíbria da jogabilidade ou por motivos técnicos/estratégicos.</p>
                        </section>

                        <section class="mb-8">
                            <h2 class="mc-font text-xl text-green-400 mb-3">5. Conduta e Sanções</h2>
                            <p class="mb-4 text-gray-300 mc-font-small">5.1. A doação <strong class="text-green-300">não isenta</strong> o jogador do cumprimento das regras do servidor. O
                                descumprimento das normas poderá resultar em punições como <strong class="text-green-300">banimento temporário ou permanente</strong>, sem qualquer tipo de compensação ou restituição dos valores doados.
                            </p>
                        </section>

                        <section class="mb-8">
                            <h2 class="mc-font text-xl text-green-400 mb-3">6. Disposições Gerais</h2>
                            <p class="mb-4 text-gray-300 mc-font-small">6.1. Estes Termos de Uso poderão ser atualizados periodicamente. É responsabilidade do
                                usuário manter-se informado sobre possíveis alterações.</p>
                            <p class="mb-4 text-gray-300 mc-font-small">6.2. Ao concluir uma compra, o usuário <strong class="text-green-300">declara estar de acordo com todos os pontos aqui descritos</strong>, assumindo total responsabilidade pela transação realizada.</p>
                        </section>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 border-t-4 border-green-600 py-8">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                <div class="text-center md:text-left">
                    <h3 class="mc-font text-green-400 mb-4">Acessibilidade</h3>
                    <button id="terms_button" class="mc-button flex items-center justify-center md:justify-start mx-auto md:mx-0 px-4 py-2 clickable">
                        <img src="./src/images/terms-and-conditions.png" alt="Termos" class="w-5 h-5 mr-2 invert">
                        <span class="mc-font-small">Termos e Condições</span>
                    </button>
                </div>
                
                <div class="text-center">
                    <h3 class="mc-font text-green-400 mb-4">Sobre Nós</h3>
                    <p class="text-gray-300 mc-font-small">
                        Criamos nosso servidor de Pixelmon em 2024 com um grande investimento em infraestrutura e desenvolvimento, 
                        com o objetivo de inovar a comunidade e oferecer uma experiência de jogo única.
                    </p>
                </div>
                
                <div class="text-center md:text-right">
                    <h3 class="mc-font text-green-400 mb-4">Redes Sociais</h3>
                    <a href="https://discord.gg/RMd3mTtj6M" target="_blank" class="mc-button inline-flex items-center px-4 py-2 clickable">
                        <img src="./src/images/discord.png" alt="Discord" class="w-5 h-5 mr-2 invert">
                        <span class="mc-font-small">Discord</span>
                    </a>
                </div>
            </div>
            
            <div class="mc-divider"></div>
            
            <div class="text-center text-gray-400 mc-font-small">
                <p class="mb-2">Copyright © PokeHype. Sem qualquer vínculo com Mojang Studios, Microsoft ou The Pokémon Company.</p>
                <p>Desenvolvido por <a href="https://luandev.blog.br" target="_blank" class="text-green-400 hover:underline">LuanDev</a>.</p>
            </div>
        </div>
    </footer>

    <script>
        const URL = "http://localhost:3000";

        // Variáveis globais
        let clickedIp = false;
        let json;
        let itemSelected;
        let confirm = false;
        let jsonWiki;
        let currentMainCategory = null;
        let currentSubcategory = null;

        // Inicialização quando o DOM estiver carregado
        document.addEventListener("DOMContentLoaded", () => {
            updateCategorys();
            setupEventListeners();
            loadWikiData();
        });

        // Configuração de eventos
        function setupEventListeners() {
            // Botão de copiar IP
            document.getElementById('ipButton')?.addEventListener('click', copyIpToClipboard);
            
            // Links de navegação
            document.getElementById('terms_button')?.addEventListener('click', showTermsPage);
            document.getElementById('wiki_button')?.addEventListener('click', showWikiPage);
            document.getElementById('shop_button')?.addEventListener('click', showShopPage);

            // Fechar modal ao clicar fora
            document.getElementById('purchaseModal')?.addEventListener('click', (e) => {
                if (e.target.id === 'purchaseModal') {
                    closeModalShopItem();
                }
            });

            // Fechar dropdowns ao clicar fora
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.category-with-dropdown')) {
                    closeAllDropdowns();
                }
            });
        }

        // Fechar todos os dropdowns
        function closeAllDropdowns() {
            document.querySelectorAll('.category-with-dropdown').forEach(cat => {
                cat.classList.remove('active');
            });
        }

        // Alternar dropdown da categoria
        function toggleCategoryDropdown(categoryContainer) {
            const isActive = categoryContainer.classList.contains('active');
            
            // Fecha todos os dropdowns
            closeAllDropdowns();
            
            // Se não estava ativo, abre este
            if (!isActive) {
                categoryContainer.classList.add('active');
            }
        }

        // Selecionar categoria principal
        function selectMainCategory(categoryIndex) {
            // Remove a classe active de todas as categorias principais
            document.querySelectorAll('.button_category').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Adiciona a classe active na categoria principal selecionada
            const selectedBtn = document.querySelector(`[data-index="${categoryIndex}"]`);
            if (selectedBtn) {
                selectedBtn.classList.add('active');
            }
            
            // Fecha todos os dropdowns
            closeAllDropdowns();
            
            // Carrega os itens da categoria
            currentMainCategory = categoryIndex;
            currentSubcategory = null;
            onClickCategory(json["categorys"][categoryIndex]);
        }

        // Selecionar subcategoria
        function selectSubcategory(subcategoryIndex) {
            // Remove a classe active de todas as subcategorias
            document.querySelectorAll('.subcategory-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Adiciona a classe active na subcategoria selecionada
            const selectedTab = document.querySelector(`[data-subindex="${subcategoryIndex}"]`);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
            
            // Fecha o dropdown
            selectedTab.closest('.category-with-dropdown').classList.remove('active');
            
            // Carrega os itens da subcategoria
            currentSubcategory = subcategoryIndex;
            onClickCategory(json["categorys"][subcategoryIndex]);
        }

        // Atualizar categorias
        async function updateCategorys() {
            const contentCategorys = document.getElementById("contentCategorysShop");
            
            try {
                const req = await fetch(`${URL}/config`);
                if (!req.ok) throw new Error("Falha na requisição");
                
                json = await req.json();
                if (!json) throw new Error("JSON inválido");
                
                contentCategorys.innerHTML = "";
                
                // Organizar categorias por grupos (categorias principais e subcategorias)
                const mainCategories = [];
                
                json["categorys"].forEach((element, i) => {
                    const nameCategory = element["name"];
                    
                    // Verifica se é uma subcategoria (contém "_")
                    if (nameCategory.includes("_")) {
                        const parts = nameCategory.split("_");
                        const mainCategoryName = parts[0];
                        const subcategoryName = parts[1];
                        
                        // Verifica se já existe a categoria principal
                        let mainCategoryIndex = mainCategories.findIndex(cat => cat.name === mainCategoryName);
                        
                        if (mainCategoryIndex === -1) {
                            // Cria nova categoria principal
                            mainCategories.push({
                                name: mainCategoryName,
                                pathIcon: element["pathIcon"],
                                index: i,
                                subcategories: [{
                                    name: subcategoryName,
                                    originalIndex: i,
                                    pathIcon: element["pathIcon"]
                                }]
                            });
                        } else {
                            // Adiciona subcategoria à categoria principal existente
                            mainCategories[mainCategoryIndex].subcategories.push({
                                name: subcategoryName,
                                originalIndex: i,
                                pathIcon: element["pathIcon"]
                            });
                        }
                    } else {
                        // É uma categoria principal sem subcategorias
                        mainCategories.push({
                            name: nameCategory,
                            pathIcon: element["pathIcon"],
                            index: i,
                            subcategories: []
                        });
                    }
                });
                
                // Renderizar categorias principais
                mainCategories.forEach((mainCategory, i) => {
                    const hasSubcategories = mainCategory.subcategories.length > 0;
                    
                    const htmlCategory = `
                        <div class="category-with-dropdown">
                            <button class="button_category mc-tab flex items-center px-4 py-2 clickable ${i === 0 && !hasSubcategories ? 'active' : ''}" 
                                    data-index="${mainCategory.index}">
                                <img src="${URL}/image/${mainCategory.pathIcon}" alt="${mainCategory.name}" class="w-5 h-5 mr-2">
                                <span class="mc-font-small">${mainCategory.name}</span>
                                ${hasSubcategories ? `
                                    <svg class="dropdown-arrow w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                ` : ''}
                            </button>
                            
                            ${hasSubcategories ? `
                                <div class="subcategory-dropdown">
                                    ${mainCategory.subcategories.map((sub, j) => `
                                        <button class="subcategory-tab flex items-center px-3 py-2 clickable ${j === 0 ? 'active' : ''}" 
                                                data-subindex="${sub.originalIndex}">
                                            <span class="mc-font-small">${sub.name}</span>
                                        </button>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    `;
                    contentCategorys.innerHTML += htmlCategory;
                });

                // Adicionar event listeners para as categorias
                setTimeout(() => {
                    document.querySelectorAll('.button_category').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            e.preventDefault();
                            const categoryButton = e.currentTarget;
                            const categoryIndex = categoryButton.dataset.index;
                            const categoryContainer = categoryButton.closest('.category-with-dropdown');
                            const hasSubcategories = categoryContainer.querySelector('.subcategory-dropdown');
                            
                            if (hasSubcategories) {
                                toggleCategoryDropdown(categoryContainer);
                            } else {
                                selectMainCategory(categoryIndex);
                            }
                        });
                    });

                    document.querySelectorAll('.subcategory-tab').forEach(tab => {
                        tab.addEventListener('click', (e) => {
                            e.preventDefault();
                            const subcategoryIndex = e.currentTarget.dataset.subindex;
                            selectSubcategory(subcategoryIndex);
                        });
                });

                if (contentCategorys.childElementCount > 0) {
                    // Seleciona a primeira categoria por padrão
                    const firstCategory = contentCategorys.querySelector('.button_category');
                    if (firstCategory) {
                        const hasSubcategories = firstCategory.closest('.category-with-dropdown').querySelector('.subcategory-dropdown');
                        
                        if (!hasSubcategories) {
                            selectMainCategory(firstCategory.dataset.index);
                        } else {
                            // Se tem subcategorias, seleciona a primeira subcategoria
                            const firstSubcategory = hasSubcategories.querySelector('.subcategory-tab');
                            if (firstSubcategory) {
                                selectSubcategory(firstSubcategory.dataset.subindex);
                            }
                        }
                    }
                }
                }, 100);

            } catch (error) {
                console.log("Não foi possível conectar às categorias da loja, tentando novamente...");
                setTimeout(updateCategorys, 5000);
            }
        }

        // Ao clicar em uma categoria
        function onClickCategory(category) {
            const contentItems = document.getElementById("contentItemsShop");
            
            contentItems.innerHTML = "";
            
            // Verifica se category é válido e tem items
            if (!category || !category.items) {
                console.error("Categoria inválida:", category);
                contentItems.innerHTML = `<p class="text-gray-300 text-center col-span-full py-8 mc-font-small">Erro ao carregar itens</p>`;
                return;
            }
            
            category.items.forEach((item, index) => {
                const title = item["title"];
                const subtitle = item["subtitle"];
                const description = item["description"];
                const iconPathItem = item["iconPath"];
                const price = item["price"];
                const promotion = item["promotion"];
                
                const htmlItem = `
                    <div class="mc-card p-4 flex flex-col h-full clickable" data-item='${JSON.stringify(item).replace(/'/g, "&#39;")}'>
                        <div class="flex justify-center mb-4">
                            <img src="${URL}/image/${iconPathItem}" alt="${title}" class="w-24 h-24 object-contain">
                        </div>
                        <h4 class="mc-font text-lg text-white mb-2 text-center">${title}</h4>
                        <p class="text-green-300 text-center mb-3 mc-font-small">${subtitle}</p>
                        
                        <div class="flex justify-center items-center mb-4">
                            ${promotion ? `<span class="mc-font text-red-400 line-through mr-2">R$ ${(price*2).toFixed(2)}</span>` : ''}
                            <span class="mc-font text-yellow-400 text-xl">R$ ${price}</span>
                        </div>
                        
                        <p class="text-gray-400 text-sm mb-4 flex-grow text-center mc-font-small">${description}</p>
                        
                        <button class="mc-button w-full flex items-center justify-center py-2 mt-auto clickable">
                            <img src="./src/images/shopping_cart.png" alt="Comprar" class="w-5 h-5 mr-2 invert">
                            <span class="mc-font-small">Comprar Agora</span>
                        </button>
                    </div>
                `;
                contentItems.innerHTML += htmlItem;
            });

            // Adicionar event listeners para os itens
            setTimeout(() => {
                document.querySelectorAll('.mc-card[data-item]').forEach(card => {
                    card.addEventListener('click', (e) => {
                        e.preventDefault();
                        const item = JSON.parse(card.dataset.item);
                        if (item) {
                            onClickItemShop(item);
                        }
                    });
                });
            }, 100);
        }

        // Ao clicar em um item da loja
        function onClickItemShop(item) {
            if (!item) return;
            
            itemSelected = item;
            confirm = false;
            
            // Cria o modal de compra
            createPurchaseModal(item);
        }

        // Criar modal de compra
        function createPurchaseModal(item) {
            const title = item["title"];
            const subtitle = item["subtitle"];
            const description = item["description"];
            const iconPathItem = item["iconPath"];
            const price = item["price"];
            
            const modalHtml = `
                <div class="flex justify-between items-center p-4 border-b border-gray-700">
                    <h2 class="mc-font text-2xl text-green-400">Comprar ${title}</h2>
                    <button class="text-gray-400 hover:text-white text-2xl clickable close-modal">&times;</button>
                </div>
                <div class="p-6">
                    <div class="flex flex-col lg:flex-row gap-6 mb-6">
                        <!-- Informações do produto -->
                        <div class="lg:w-2/5">
                            <div class="mc-card p-4 flex flex-col items-center text-center">
                                <img src="${URL}/image/${iconPathItem}" alt="${title}" class="w-32 h-32 mb-4">
                                <h3 class="mc-font text-xl text-white mb-2">${title}</h3>
                                <p class="text-green-300 mb-4 mc-font-small">${subtitle}</p>
                                <div class="mc-font text-2xl text-yellow-400 mb-4">R$ ${price}</div>
                                <p class="text-gray-300 text-sm mc-font-small">${description}</p>
                            </div>
                        </div>
                        
                        <!-- Formulário de compra -->
                        <div class="lg:w-3/5">
                            <div class="mc-card p-4">
                                <h3 class="mc-font text-xl text-green-400 mb-4">Informações da Compra</h3>
                                
                                <div class="mb-4">
                                    <label for="inputNick" class="block text-gray-300 mb-2 mc-font-small">Nickname no Minecraft <span class="text-red-500">*</span></label>
                                    <input type="text" id="inputNick" class="mc-input w-full" placeholder="Ex: lHawk_" maxlength="16">
                                </div>
                                
                                <div class="mb-6">
                                    <label class="block text-gray-300 mb-2 mc-font-small">Quantidade</label>
                                    <div class="mc-font text-xl text-green-300 mc-font-small">1x</div>
                                </div>
                                
                                <button id="confirmBuyButton" class="mc-button w-full flex items-center justify-center py-3 text-lg clickable">
                                    <img src="./src/images/check.png" alt="Confirmar" class="w-6 h-6 mr-2 invert">
                                    <span class="mc-font">Confirmar Compra</span>
                                </button>
                            </div>
                            
                            <!-- Preview do jogador -->
                            <div class="mc-card p-4 mt-4 flex flex-col items-center">
                                <img src="https://mc-heads.net/player/" alt="Player Skin" class="w-32 h-auto mb-2" id="playerOfNick">
                                <p class="text-gray-300 mc-font-small text-center">Preview do seu personagem</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Aviso importante -->
                    <div class="mc-card p-4 bg-red-900 bg-opacity-30 border-red-700">
                        <div class="flex items-start">
                            <img src="./src/images/warning.png" alt="Aviso" class="w-6 h-6 mr-3 mt-1 invert">
                            <div>
                                <span class="font-bold text-red-300 mc-font-small">ATENÇÃO:</span>
                                <p class="text-gray-300 mc-font-small mt-1">
                                    Ao comprar o produto, você concorda automaticamente com nossos 
                                    <a href="#" class="text-green-300 hover:underline clickable" id="termsLink">termos e condições</a>. 
                                    Após o pagamento, você deverá entrar em nosso servidor com o nick selecionado e executar o comando 
                                    <span class="text-green-400 mc-font-small">/CaixaPostal</span> para verificar o status do pagamento e resgatar suas compras.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            const modalContent = document.querySelector('.modal-content');
            modalContent.innerHTML = modalHtml;
            
            // Adicionar event listeners para o modal
            document.querySelector('.close-modal')?.addEventListener('click', closeModalShopItem);
            document.getElementById('confirmBuyButton')?.addEventListener('click', confirmBuy);
            document.getElementById('termsLink')?.addEventListener('click', (e) => {
                e.preventDefault();
                closeModalShopItem();
                showTermsPage();
            });
            
            // Event listener para o input do nick
            const nickInput = document.getElementById('inputNick');
            const playerImg = document.getElementById('playerOfNick');
            
            if (nickInput && playerImg) {
                nickInput.addEventListener('input', (e) => {
                    const sanitizedValue = sanitizeInput(e.target.value);
                    if (sanitizedValue.length >= 3) {
                        playerImg.src = `https://mc-heads.net/player/${sanitizedValue}`;
                    } else {
                        playerImg.src = `https://mc-heads.net/player/`;
                    }
                });
            }
            
            // Mostrar o modal
            document.getElementById('purchaseModal').classList.add('active');
        }

        // Fechar modal de compra
        function closeModalShopItem() {
            document.getElementById('purchaseModal').classList.remove('active');
        }

        // Copiar IP para a área de transferência
        function copyIpToClipboard() {
            if (clickedIp) return;
            
            const ipElement = document.getElementById("ip");
            const originalText = ipElement.textContent;
            const ipToCopy = originalText.replace('IP:', '').trim();
            
            navigator.clipboard.writeText(ipToCopy).then(() => {
                const button = document.getElementById("ipButton");
                const originalHTML = button.innerHTML;
                
                button.innerHTML = `
                    <span class="mc-font-small text-green-300">IP COPIADO!</span>
                    <span class="mc-font-small bg-green-700 px-3 py-1 rounded">✓</span>
                `;
                
                clickedIp = true;
                setTimeout(() => {
                    button.innerHTML = originalHTML;
                    clickedIp = false;
                }, 1500);
            }).catch((err) => {
                const button = document.getElementById("ipButton");
                const originalHTML = button.innerHTML;
                
                button.innerHTML = `
                    <span class="mc-font-small text-red-300">ERRO AO COPIAR</span>
                    <span class="mc-font-small bg-red-700 px-3 py-1 rounded">✗</span>
                `;
                
                clickedIp = true;
                setTimeout(() => {
                    button.innerHTML = originalHTML;
                    clickedIp = false;
                }, 1500);
            });
        }

        // Sanitizar entrada de texto
        function sanitizeInput(input) {
            // Remove tags HTML
            input = input.replace(/<[^>]*>?/gm, '');
            
            // Permite letras, números, espaços, underscores e pontos
            input = input.replace(/[^a-zA-Z0-9\\s_\\.]/g, '');
            
            // Remove espaços em branco no início e no final
            input = input.trim();
            
            // Remove espaços em branco extras no meio
            input = input.replace(/\\s+/g, ' ');
            
            return input;
        }

        // Confirmar compra
        async function confirmBuy() {
            if (confirm) return;
            confirm = true;
            
            const button = document.getElementById("confirmBuyButton");
            if (!button) return;
            
            const originalContent = button.innerHTML;
            button.innerHTML = `<div class="loader rounded-full animate-spin bg-transparent border-b-4 border-b-green-500 w-8 h-8"></div>`;
            button.disabled = true;
            
            const item = itemSelected;
            const title = item["title"];
            const subtitle = item["subtitle"];
            const description = item["description"];
            const iconPathItem = item["iconPath"];
            const price = item["price"];
            const itemIndex = item["itemIndex"];
            const categoryIndex = item["categoryIndex"];
            const nickElement = document.getElementById("inputNick");
            const nick = nickElement ? nickElement.value : '';
            
            if (!nick || nick.length < 3) {
                alert("O nick deve ter no mínimo 3 caracteres!");
                button.innerHTML = originalContent;
                button.disabled = false;
                confirm = false;
                return;
            }
            
            try {
                const req = await fetch(`${URL}/payment`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        nick: nick,
                        title: title,
                        description: title + ", " + subtitle + ". " + description,
                        pictureUrl: `${URL}/image/${iconPathItem}`,
                        unit_price: Number(price).toFixed(2),
                        quantity: 1, // SEMPRE 1, REMOVIDA A OPÇÃO DE QUANTIDADE
                        itemIndex: itemIndex,
                        categoryIndex: categoryIndex
                    })
                });

                const json = await req.json();
                if (!json || !json.initPoint) {
                    throw new Error("Resposta inválida do servidor");
                }
                
                // Abre em nova aba/janela
                window.open(json.initPoint, "_blank");
                
                // Fecha o modal e recarrega a página após um breve delay
                setTimeout(() => {
                    closeModalShopItem();
                    window.location.reload();
                }, 2000);
                
            } catch (error) {
                console.error("Erro na compra:", error);
                alert("Não foi possível completar a compra, tente novamente mais tarde!");
                button.innerHTML = originalContent;
                button.disabled = false;
                confirm = false;
            }
        }

        // Funções de navegação entre páginas
        function showTermsPage() {
            document.querySelectorAll('.page-hidden').forEach(page => {
                page.classList.remove('page-hidden');
            });
            document.getElementById('contentMainPage').classList.add('page-hidden');
            document.getElementById('contentWikiPage').classList.add('page-hidden');
            document.getElementById('contentTermsPage').classList.remove('page-hidden');
            
            // Scroll para o topo
            window.scrollTo(0, 0);
        }

        function showWikiPage() {
            document.querySelectorAll('.page-hidden').forEach(page => {
                page.classList.remove('page-hidden');
            });
            document.getElementById('contentMainPage').classList.add('page-hidden');
            document.getElementById('contentWikiPage').classList.remove('page-hidden');
            document.getElementById('contentTermsPage').classList.add('page-hidden');
            
            // Scroll para o topo
            window.scrollTo(0, 0);
        }

        function showShopPage() {
            document.querySelectorAll('.page-hidden').forEach(page => {
                page.classList.remove('page-hidden');
            });
            document.getElementById('contentMainPage').classList.remove('page-hidden');
            document.getElementById('contentWikiPage').classList.add('page-hidden');
            document.getElementById('contentTermsPage').classList.add('page-hidden');
            
            // Scroll para o topo
            window.scrollTo(0, 0);
        }

        // Carregar dados da wiki
        async function loadWikiData() {
            try {
                const req = await fetch(`${URL}/wiki`);
                const json = await req.json();
                if (!json) return;
                jsonWiki = json;
                
                const contentButtons = document.getElementById("contentButtonsWiki");
                contentButtons.innerHTML = "";
                let index = 0;
                for(let element of json["pages"]) {
                    let name = element["name"];
                    let iconPath = element["iconPath"];
                    let title = element["title"];
                    let contentHtml = element["content"];
                    
                    const htmlButton = `
                        <button class="buttonWiki mc-button w-full flex items-center justify-start p-3 mb-2 clickable ${index === 0 ? 'active' : ''}" data-item="${index}" id="buttonWiki_${index}">
                            <img src="${URL}/image/${iconPath}" alt="${name} icon" class="w-5 h-5 mr-3">
                            <span class="mc-font-small">${title}</span>
                        </button>
                    `;
                    contentButtons.innerHTML += htmlButton;
                    index++;
                }

                // Adicionar event listeners para os botões da wiki
                setTimeout(() => {
                    document.querySelectorAll('.buttonWiki').forEach(button => {
                        button.addEventListener('click', (e) => {
                            e.preventDefault();
                            onClickButtonWiki(e.currentTarget);
                        });
                    });

                    if (contentButtons.childElementCount > 0) {
                        const firstElement = contentButtons.querySelector(".buttonWiki");
                        if (firstElement) {
                            onClickButtonWiki(firstElement);
                        }
                    }
                }, 100);

            } catch (error) {
                console.log("Não foi possível conectar à wiki, tentando novamente...");
                setTimeout(loadWikiData, 5000);
            }
        }

        // Ao clicar em um botão da wiki
        function onClickButtonWiki(buttonElement) {
            if (!buttonElement.classList.contains("buttonWiki")) return;
            
            document.querySelectorAll(".buttonWiki").forEach(button => {
                button.classList.remove("active");
            });
            
            buttonElement.classList.add("active");
            const element = jsonWiki["pages"][buttonElement.dataset.item];
            const title = element["title"];

            // setando o titulo da pagina.
            const contentTitle = document.getElementById("titleContentWiki");
            contentTitle.innerHTML = title;

            // setando o conteúdo da pagina.
            const content = document.getElementById("contentGeneralWiki");
            content.innerHTML = element["content"];
        }
    </script>
</body>
</html>